<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Keycloak Giriş Örneği</title>
    <script src="https://cdn.jsdelivr.net/npm/keycloak-js@12.0.3/dist/keycloak.min.js"></script>
    <script>
      function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      var keycloak = Keycloak({
        realm: "magic",
        url: "https://sso.consumer.games/auth",
        clientId: "account-console",
      });

      keycloak
        .init()
        .then(function (authenticated) {
          if (authenticated) {
            // Kullanıcı zaten giriş yapmışsa burada yönlendirme işlemlerini yapabilirsiniz
            console.log("Kullanıcı zaten giriş yapmış");
          } else {
            // Giriş yapmamış kullanıcıyı yönlendir
            keycloak.login();
          }
        })
        .catch(function (error) {
          console.error("Konfigürasyon hatası:", error);
        });

      window.addEventListener("load", function () {
        var code = getParameterByName("code");

        if (code) {
          keycloak
            .grantManager()
            .grant({ code: code, redirect_uri: "https://oyun.ates.com" })
            .then(function (grant) {
              var token = grant.access_token;
              // Token'ı kullanarak kullanıcıyı doğrulama ve yetkilendirme işlemlerini gerçekleştirin
              console.log("Token:", token);
            })
            .catch(function (error) {
              console.error("Hata:", error);
            });
        }
      });
    </script>
  </head>
  <body>
    <h1>Keycloak Giriş Örneği</h1>
  </body>
</html>
